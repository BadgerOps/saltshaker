DefineExternalAuth mn-authclient-{{servername}} pipe "/usr/local/bin/mn-authclient.py -u https://{{auth_url}}/checkpassword/ -m authext --ca-file /etc/ssl/certs/ca-certificates.crt"
<VirtualHost {{ip}}:{{port}}>
    SSLEngine On
    SSLCertificateFile {{cert}}
    SSLCertificateKeyFile {{certkey}}
    ServerName {{servername}}

    DocumentRoot /secure/sites/maurus.net/webdav
    ErrorLog /secure/sites/maurus.net/logs/error_log.webdav
    CustomLog /secure/sites/maurus.net/logs/access_log.webdav combined

    AcceptPathInfo On

    DavLockDB /secure/sites/maurus.net/webdav.lockdb

    <Directory /secure/sites/maurus.net/webdav/>
        DAV On
        DavDepthInfinity On

        # wait for OpenID connect support in django-oauth-toolkit, then use
        # libapache2-mod-auth-openidc as the auth backend
        AuthType Basic
        AuthName "{{authrealm}}"
        AuthBasicProvider external
        AuthExternal mn-authclient-{{servername}}
        Require valid-user
        Options Indexes
        <Limit HEAD GET POST OPTIONS PROPFIND>
            require valid-user
        </Limit>
        <Limit MKCOL PUT DELETE LOCK UNLOCK COPY MOVE PROPPATCH>
            Deny from all
        </Limit>
    </Directory>

    #<Directory /secure/sites/maurus.net/webdav/jm/>
    #    <Limit HEAD GET POST OPTIONS PROPFIND MKCOL PUT DELETE LOCK UNLOCK COPY MOVE PROPPATCH>
    #        allow from all
    #        require user jonas
    #    </Limit>
    #</Directory>
</VirtualHost>
