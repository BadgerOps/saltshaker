{% if pillar['vault']['backend'] == 'mysql' %}
backend "mysql" {
    username = "vault"
    password = "{{pillar['dynamicpasswords']['secure-vault']}}"
    address = "127.0.0.1:3307"  # SmartStack address and port of the secure-database role
    database = "vault"
    path = "{{pillar['vault']['path']}}"
}
{% elif pillar['vault']['backend'] == 'consul' %}
backend "consul" {
    address = "localhost:8500"
    path = "{{pillar['vault']['path']}}"
}
{% elif pillar['vault']['backend'] == 's3' %}
backend "s3" {
    bucket = "{{pillar['vault']['s3']['bucket']}}"
    region "{{pillar['vault']['s3']['aws-region']}}"
    access_key = "{{pillar['vault']['s3']['aws-accesskey']}}"
    secret_key = "{{pillar['vault']['s3']['aws-secretkey']}}"
    path = "{{pillar['vault']['path']}}"
}
{% endif %}

listener "tcp" [
    address = "127.0.0.1:8200"
    
}

{% if pillar['vault']['enable-telemetry'] %}
telemetry {
    {% if pillar['vault'].get('telemetry', {}).get('statsite', False) %}
        statsite_address = "{{pillar['vault']['telemetry']['statsite']}}"
    {% elif pillar['vault'].get('telemetry', {}).get('statsd', False) %}
        statsd_address = "{{pillar['vault']['telemetry']['statsd']}}"
    {% endif %}
    {% if pillar['vault'].get('telemetry', {}).get('disable_hostname', False) %}
        disable_hostname = true
    {% endif %}
}
{% endif %}
